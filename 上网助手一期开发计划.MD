# 上网助手一期开发计划

## 项目概述

本计划旨在基于现有的翻译插件，开发一个综合性的上网助手工具，整合文本翻译和文本改写功能。一期开发将重点关注核心功能的实现和现有代码的充分利用。

## 功能需求分析

### 核心功能
1. 网页文本选择与同步
2. 大模型统一配置管理
3. 翻译功能（保留并优化现有功能）
4. 改写功能（新增功能）
5. 结果展示与复制功能

### 非功能性需求
1. 充分利用现有代码，减少重复开发
2. 保持与现有翻译功能的一致性
3. 提供良好的用户体验
4. 确保代码的可维护性和可扩展性

## 技术架构设计

### 前端组件
1. **Sidebar界面更新**
   - 整合翻译和改写功能界面
   - 统一的大模型配置区域
   - 功能切换标签页实现

2. **Content Script**
   - 复用现有的文本选择监听机制
   - 保持与Sidebar的消息传递机制

3. **Background Script**
   - 统一的大模型配置管理
   - 翻译和改写功能的API调用

### 后端集成
1. **大模型API调用**
   - 复用现有的大模型配置和调用机制
   - 添加改写功能的API请求构建逻辑

## 详细开发任务

### 第一阶段：界面重构与整合 (5天)

#### 任务1.1: Sidebar界面重构
- [ ] 重新设计sidebar.html界面布局
- [ ] 实现功能切换标签页
- [ ] 整合大模型配置区域
- [ ] 保留翻译功能区域
- [ ] 添加改写功能区域
- [ ] 确保界面风格统一

#### 任务1.2: Sidebar脚本更新
- [ ] 更新sidebar.js以支持新的界面结构
- [ ] 实现标签页切换功能
- [ ] 整合大模型选择逻辑
- [ ] 保留现有翻译功能逻辑
- [ ] 实现改写功能逻辑

### 第二阶段：功能逻辑实现 (7天)

#### 任务2.1: Background脚本更新
- [ ] 整合大模型配置管理逻辑
- [ ] 保留现有翻译API调用逻辑
- [ ] 实现改写功能的API调用逻辑
- [ ] 添加统一的错误处理机制

#### 任务2.2: Content Script优化
- [ ] 优化文本选择监听机制
- [ ] 确保与Sidebar的消息传递稳定可靠
- [ ] 添加必要的调试信息

#### 任务2.3: Manifest文件更新
- [ ] 检查并更新必要的权限配置
- [ ] 确保所有功能正常运行

### 第三阶段：测试与优化 (3天)

#### 任务3.1: 功能测试
- [ ] 测试文本选择同步功能
- [ ] 测试大模型配置功能
- [ ] 测试翻译功能
- [ ] 测试改写功能
- [ ] 测试界面切换和交互

#### 任务3.2: 兼容性测试
- [ ] 在不同浏览器上测试功能
- [ ] 在不同类型网站上测试文本选择功能
- [ ] 测试不同大模型的兼容性

#### 任务3.3: 性能优化
- [ ] 优化界面响应速度
- [ ] 减少内存占用
- [ ] 优化API调用性能

## 具体实现细节

### Sidebar界面更新

#### HTML结构重构
1. 重新组织HTML结构以支持功能切换：
   ```html
   <div class="tab-container">
       <button class="tab-button active" data-tab="translate">翻译</button>
       <button class="tab-button" data-tab="rewrite">改写</button>
   </div>
   
   <div class="tab-content">
       <div id="translate-tab" class="tab-pane active">
           <!-- 翻译功能界面 -->
       </div>
       <div id="rewrite-tab" class="tab-pane">
           <!-- 改写功能界面 -->
       </div>
   </div>
   ```

2. 统一的大模型配置区域：
   ```html
   <div class="section">
       <h2>大模型配置</h2>
       <div class="form-group">
           <label for="modelSelect">选择大模型:</label>
           <select id="modelSelect">
               <option value="kimi">Kimi</option>
               <option value="deepseek">DeepSeek</option>
               <option value="qwen">Qwen</option>
               <option value="doubao">Doubao</option>
           </select>
       </div>
       <!-- 大模型配置表单 -->
   </div>
   ```

#### CSS样式更新
1. 添加标签页相关样式：
   ```css
   .tab-container {
       display: flex;
       margin-bottom: 20px;
   }
   
   .tab-button {
       padding: 10px 20px;
       border: none;
       background-color: #f0f0f0;
       cursor: pointer;
       border-radius: 4px 4px 0 0;
   }
   
   .tab-button.active {
       background-color: #007bff;
       color: white;
   }
   
   .tab-pane {
       display: none;
   }
   
   .tab-pane.active {
       display: block;
   }
   ```

### JavaScript逻辑实现

#### Sidebar脚本更新
1. 添加标签页切换功能：
   ```javascript
   // 标签页切换逻辑
   function initTabs() {
       const tabButtons = document.querySelectorAll('.tab-button');
       const tabPanes = document.querySelectorAll('.tab-pane');
       
       tabButtons.forEach(button => {
           button.addEventListener('click', () => {
               const tabId = button.getAttribute('data-tab');
               
               // 更新按钮状态
               tabButtons.forEach(btn => btn.classList.remove('active'));
               button.classList.add('active');
               
               // 显示对应的内容面板
               tabPanes.forEach(pane => {
                   pane.classList.remove('active');
                   if (pane.id === `${tabId}-tab`) {
                       pane.classList.add('active');
                   }
               });
           });
       });
   }
   ```

2. 整合大模型选择逻辑：
   ```javascript
   // 大模型选择逻辑
   const modelSelect = document.getElementById('modelSelect');
   modelSelect.addEventListener('change', function() {
       const selectedModel = modelSelect.value;
       // 保存选择的模型
       chrome.storage.local.set({ selectedModel: selectedModel });
       // 加载对应模型的配置
       loadModelConfig(selectedModel);
   });
   ```

3. 保留现有翻译功能逻辑并优化：
   ```javascript
   // 翻译功能保持现有逻辑，但适配新界面
   translateBtn.addEventListener('click', async function() {
       // 复用现有翻译逻辑
   });
   ```

4. 实现改写功能逻辑：
   ```javascript
   // 改写功能实现
   const rewriteBtn = document.getElementById('rewriteBtn');
   rewriteBtn.addEventListener('click', async function() {
       // 实现改写功能逻辑
   });
   ```

### Background脚本更新

#### 消息处理机制
1. 整合消息处理逻辑：
   ```javascript
   chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
       switch (request.action) {
           case "translate":
               handleTranslateRequest(request, sender, sendResponse);
               return true;
           case "rewrite":
               handleRewriteRequest(request, sender, sendResponse);
               return true;
           case "saveApiKey":
               handleSaveApiKey(request, sender, sendResponse);
               return true;
           case "testConnection":
               handleTestConnection(request, sender, sendResponse);
               return true;
           case "loadModelConfig":
               handleLoadModelConfig(request, sender, sendResponse);
               return true;
           default:
               sendResponse({ error: "未知的操作类型" });
       }
   });
   ```

#### 大模型配置管理
1. 整合大模型配置管理逻辑：
   ```javascript
   // 统一的大模型配置管理
   class ModelConfigManager {
       constructor() {
           this.models = {
               kimi: { /* 配置 */ },
               deepseek: { /* 配置 */ },
               qwen: { /* 配置 */ },
               doubao: { /* 配置 */ }
           };
       }
       
       async loadConfig(model) {
           // 加载模型配置
       }
       
       async saveConfig(model, config) {
           // 保存模型配置
       }
   }
   ```

## 测试计划

### 功能测试
1. 文本选择同步测试
   - 验证在不同网页上选择文本能否正确同步到插件
   - 验证选中文本变化时插件能否实时更新

2. 大模型配置测试
   - 验证大模型选择功能是否正常
   - 验证API Key保存和加载功能
   - 验证连接测试功能

3. 翻译功能测试
   - 验证各种语言的翻译功能
   - 验证不同大模型的翻译功能
   - 验证翻译结果展示和复制功能

4. 改写功能测试
   - 验证提示词编辑功能
   - 验证不同大模型的改写功能
   - 验证改写结果展示和复制功能

### 兼容性测试
1. 浏览器兼容性测试
   - 在不同版本的Chrome浏览器上测试功能
   - 验证扩展在不同操作系统上的表现

2. 网站兼容性测试
   - 在不同类型的网站上测试文本选择功能
   - 验证在特殊网站上的表现

### 性能测试
1. 响应时间测试
   - 测试文本选择同步的响应时间
   - 测试翻译和改写功能的响应时间

2. 资源占用测试
   - 监控扩展的内存占用情况
   - 监控扩展的CPU使用情况

## 风险评估与应对措施

### 技术风险
1. **界面重构风险**
   - 风险：界面重构可能影响现有功能
   - 应对：采用渐进式重构，确保每步修改后功能正常

2. **功能整合风险**
   - 风险：翻译和改写功能整合可能出现冲突
   - 应对：采用模块化设计，确保功能独立性

3. **兼容性风险**
   - 风险：新功能可能在某些网站上不工作
   - 应对：准备备选方案和错误处理机制

### 用户体验风险
1. **界面复杂度增加**
   - 风险：新增功能可能导致界面过于复杂
   - 应对：通过标签页等方式保持界面简洁

2. **学习成本增加**
   - 风险：用户可能需要时间适应新界面
   - 应对：保持操作逻辑一致性，提供必要的提示

## 项目时间规划

### 第一阶段：界面重构与整合 (5天)
- 第1-2天：完成sidebar.html界面重构
- 第3天：完成sidebar.js脚本更新
- 第4天：完成CSS样式调整
- 第5天：完成初步测试和调整

### 第二阶段：功能逻辑实现 (7天)
- 第1-2天：完成background.js脚本更新
- 第3-4天：完成content script优化
- 第5天：完成manifest文件更新
- 第6-7天：完成功能集成和初步测试

### 第三阶段：测试与优化 (3天)
- 第1天：完成功能测试和bug修复
- 第2天：完成兼容性测试和性能优化
- 第3天：完成用户体验优化和文档编写

## 验收标准

1. 功能完整性
   - 网页文本选择同步功能正常
   - 大模型配置功能正常
   - 翻译功能保持原有水平
   - 改写功能实现并正常工作
   - 界面切换流畅

2. 用户体验
   - 界面布局合理，操作流畅
   - 错误提示清晰明确
   - 响应时间在可接受范围内

3. 代码质量
   - 充分利用现有代码，避免重复开发
   - 代码结构清晰，易于维护
   - 遵循现有代码风格和规范
   - 有适当的注释和文档

4. 兼容性
   - 在主流浏览器上功能正常
   - 在常见网站上文本选择功能正常